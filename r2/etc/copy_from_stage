# Copyright 2012 Jeffrey Kegler
# This file is part of Marpa::R2.  Marpa::R2 is free software: you can
# redistribute it and/or modify it under the terms of the GNU Lesser
# General Public License as published by the Free Software Foundation,
# either version 3 of the License, or (at your option) any later version.
#
# Marpa::R2 is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser
# General Public License along with Marpa::R2.  If not, see
# http://www.gnu.org/licenses/.

use 5.010;
use strict;
use warnings;
use Fatal qw(open close chdir chmod utime);

# Portability is NOT emphasized here -- this script is part
# of the development environment, not the configuration or
# installation environment

my $version_info = `libmarpa/stage/configure --version`;
my ($version) = $version_info =~ m/\A marpa \s configure \s ([\d.]*)$/msx;
my $tar_file = 'stage/marpa-' . $version . '.tar.gz';
my $untarred_dir = 'marpa-' . $version;
say $tar_file;

if (-d 'libmarpa/build') {
    system('rm -rf libmarpa/build') and die "rm -rf libmarpa/build failed: $!";
}
chdir 'libmarpa';
system('tar', '-xvzf', $tar_file) == 0 or die("Could not tar -xvzf $tar_file: $!");
rename $untarred_dir, 'build' or die "rename failed: $!";

